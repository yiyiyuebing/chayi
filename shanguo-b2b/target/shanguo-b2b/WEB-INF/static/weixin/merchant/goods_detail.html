<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <link href="//cdn.bootcss.com/Swiper/3.3.1/css/swiper.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/fonts/iconfont.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/ui-box.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/iSlider.min.css">
    <link rel="stylesheet" href="css/goods_detail.css">
    <title>商品详情</title>
</head>
<body id="goodsDetail" class="bg-main goods-detail">
<div id="detailCon" class="op0">
    <div class="goods-img">
        <div id="slider-content">
        
        </div>
        
        <div v-if="bestActivity && bestActivity.tag1 && bestActivity.tag1Valid == 'T'" class="press-img"><img :src="bestActivity.tag1" alt=""></div>
    </div>
    <div id="timer-out" class="presell-count" style="display: none;">
            <div class="countTitle">预售价</div>
            <div class="countPrice-view"><span class="countPrice"></span><span v-if="isSale" class="sell-num fs-13">{{bestActivity.vmCount+(bestActivity.saleNum ? bestActivity.saleNum : 0)}}人已定</span></div>
            <div class="count-right">
                <div class="title-show">距开始还有：</div>
                <div class="timer-out" class="goods-statu1">
                    <i class="day timer"></i>
                    <i class="timer">天</i>
                    <i class="hour timer bg-timeG"></i>
                    <i class="timer">:</i>
                    <i class="min timer bg-timeG"></i>
                    <i class="timer">:</i>
                    <i class="sec timer bg-timeG"></i>
                    <i class="timer"></i>
                </div>
            </div>
        </div>
    <div class="dis-tabel w100 goods-tit">
        <div class="dis-cell w100">
            <h4><span v-if="detail.label" class="nameType">{{detail.label}}</span>{{detail.name}}</h4>
        </div>
    </div>
    <div class="desc" v-if="detail.subtitle">{{detail.subtitle}}</div>
    <!--普通商品-->
    <template v-if="activityType == 1">
        <div class="priceView bg-white">
            <div>
                <span class="left-w45"><span class="color-main">零售价：</span>
                <span class="bigPrice color-main">¥{{selectSukgood.retailPrice}}</span></span>一口价：<span class="linePrice">¥{{selectSukgood.fixedPrice}}</span></div>
            <div v-if="isSubAccount == 'F'">供货价：¥{{selectSukgood.supplyPrice}}</div>
            <div>&nbsp;&nbsp;&nbsp;&nbsp;销量：{{detail.totalSaleNum || 0}}</div>
        </div>
    </template>
    <!--促销商品-->
    <template v-if="activityType == 2">
        <div  class="priceView bg-white">
            <div>
                <span class="color-main">促销价：</span>
                <span class="bigPrice color-main">¥{{detail.salePrice}}</span>
                <span class="borderPrice">促销</span>
            </div>
            <div>
                <span v-if="isSubAccount == 'F'">供货价：¥{{selectSukgood.supplyPrice}} &nbsp;&nbsp;&nbsp;</span>
                <span class="fs-10">一口价：<span class="linePrice">¥{{selectSukgood.fixedPrice}}</span></span>
            </div>
            <div>&nbsp;&nbsp;&nbsp;销量：{{detail.totalSaleNum || 0}}</div>
        </div>
    </template>
    <!--团购商品-->
    <template v-if="activityType == 3">
        <div  class="priceView bg-white">
            <div v-if="isSubAccount == 'F'">供货价：¥{{selectSukgood.supplyPrice}}</div>
        </div>
    </template>
    <!--预售商品有定金-->
    <template v-if="activityType == 4">
        <div  class="priceView bg-white">
            <div class="color-red">
                <span>预售价：</span>
                <span class="bigPrice">¥{{bestActivity.presellAmount}}</span>
            </div>
            <div>
                <span v-if="isSubAccount == 'F'">供货价：¥{{selectSukgood.supplyPrice}} &nbsp;&nbsp;&nbsp;</span>
                <span class="fs-10">一口价：<span class="linePrice">¥{{selectSukgood.fixedPrice}}</span></span>
            </div>
            <div>&nbsp;&nbsp;&nbsp;&nbsp;尾款：
                <span class="color-red">¥{{bestActivity.remainingAmount}}</span>
                <span class="fs-10">({{bestActivity.paymentStartShow}}-{{bestActivity.paymentEndShow}})</span>
            </div>
            <div>&nbsp;&nbsp;&nbsp;&nbsp;销量：{{detail.totalSaleNum || 0}}</div>
            <div class="presell">
                <div><span class="redType">{{bestActivity.tag2}}</span>&nbsp;&nbsp;<span>{{bestActivity.presellDesc}}</span> <i class="presell-icon" v-on:click="screen(2)"></i></div>
                <div v-if="bestActivity.shipTime">预计发货时间：{{bestActivity.shipTimeShow}}</div>
            </div>
        </div>
    </template>
    <!--预售商品有全款-->
    <template v-if="activityType == 5">
        <div  class="priceView bg-white">
            <div>
                <span v-if="isSubAccount == 'F'">供货价：¥{{selectSukgood.supplyPrice}} &nbsp;&nbsp;&nbsp;</span>
                <span class="fs-10">一口价：<span class="linePrice">¥{{selectSukgood.fixedPrice}}</span></span>
            </div>
            <div>&nbsp;&nbsp;&nbsp;&nbsp;销量：{{detail.totalSaleNum || 0}}</div>
            <div class="presell">
                <div><span class="redType">{{bestActivity.tag2}}</span>&nbsp;&nbsp;<span>{{bestActivity.presellDesc}}</span> <i class="presell-icon" v-on:click="screen(2)"></i></div>
                <div v-if="bestActivity.shipTime">预计发货时间：{{bestActivity.shipTimeShow}}</div>
            </div>
        </div>
    </template>
    <!--中间选择框-->
    <div v-if="false" v-on:click="screen(1)" class="goods-choose" style="margin-bottom: 0.6125rem;">
        <div style="margin-left: 0.5rem;"><span class="redType">促销</span>每次订单满18000元，优惠200元</div>
        <div class="right-arrow"><i class="iconfont">&#xe65e;</i></div>
    </div>
    <!--数量弹窗-->
    <div v-on:click="screen(0)" class="goods-choose" style="margin-bottom: 0.6125rem;">
        <div class="goods-choose-tit">选择</div>
        <div class="dis-cell">规格/数量</div>
        <div class="right-arrow"><i class="iconfont">&#xe65e;</i></div>
    </div>
    <div v-if="bestActivity.limitNum" class="goods-choose" style="margin-top: -0.5rem;margin-bottom: 0.6125rem;">
        <div style="margin-left: 0.5rem;"><span class="redType">限购</span> {{bestActivity.limitNum}} {{bestActivity.limitUnit ? bestActivity.limitUnit: '件'}}/人</div>
    </div>

    <!--商品参数-->
    <div v-on:click="toShow('skuInfo')" class="goods-choose" style="margin-bottom: 0.6125rem;">
        <div class="dis-cell color-grey">产品参数</div>
        <div class="right-arrow"><i class="iconfont">&#xe65e;</i></div>
    </div>
    

    <!--评论详情-->
    <template v-if="evaluateVal.length > 0">
        <div class="goods-choose" style="margin-bottom: 1px;">
            <div class="dis-cell color-grey">评论({{evaluateVal.length}})</div>
        </div>
        <div class="evaluate bg-white mar-b1">
            <template v-if="evaluateThree && evaluateThree.length > 0">
                <ul>
                    <template v-for="list in evaluateThree">
                        <li>
                            <div class="top dis-table">
                                <div class="avatar dis-cell">
                                    <img :src="list.headImage || 'img\\icons\\defaultimg.png'" />
                                </div> 
                                <div class="dis-cell">
                                    {{list.username}}<br>
                                    <template v-for="i in list.score">
                                        <i class="dis-cell stara"></i>
                                    </template>
                                    <template v-for="x in 5-list.score">
                                        <i class="dis-cell star"></i>
                                    </template>
                                </div>
                                <div class="date">
                                    <em class="ta-r color-grey">{{list.time}}</em>
                                </div>
                            </div>
                            <div class="text">
                                <div>{{list.content}}</div>
                                <div class="img" v-if="list.images && list.images.images && list.images.images.length>0">
                                    <template v-for="img in list.images.images">
                                        <img class="eva-img" :src="img.url" v-on:click="showEvaImg(list.images.images, $index)">
                                    </template>
                                </div>
                                <div class="color-main mar-3" v-if="list.replied && list.replied.content">答复：{{list.replied.content}}</div>
                                <div class="color-grey mar-5" v-if="list.goodName">规格：{{list.goodName}}</div>
                                <div class="color-grey" v-if="list.buyTime">购买时间：{{list.buyTime}}</div>
                            </div>
                        </li>
                    </template>
                    <div v-show="evaluateVal.length>3" class="btn" v-on:click="toShow('evaluate')">查看更多评论</div>
                </ul>
            </template>
            <template v-else>
                <div id="emptyIcon">
                    <div class="empty-icon"><img src="img/icons/no.png" alt=""></div>
                    <p class="fs-14 ta-c">该商品暂无评论</p>
                </div>
            </template>
        </div>
    </template>
    <template v-else>
        <div class="goods-choose" style="margin-bottom: 0.6125rem;">
            <div class="dis-cell color-grey">暂无评价</div>
        </div>
    </template>

    <!--tab切换-->
    <div id="tuwen"  class="bg-white p10 ta-c fs-14 clearfix border-b1">
        <div v-on:click="switchT('detailimg')" id="detailimg" class="switchTit fl color-main w33 border-l1">图文详情</div>
        <div v-on:click="switchT('skuInfo')" id="skuInfo" class="switchTit fl w33 border-l1">产品参数</div>
        <div v-on:click="switchT('evaluate')" id="evaluate" class="switchTit  fl w33">买家评论</div>
    </div>
    <div>
        <!--图文-->
        <div class="switch detailimg">
            <div v-if="detailInfo" v-html="detailInfo">

            </div>
            <ul v-if="imgList.length > 0 && !detailInfo">
                <template v-for="img in imgList">
                    <li><img :src="img.url" alt=""></li>
                </template>
            </ul>
        </div>
        <!--产品参数-->
        <div class="switch skuInfo bg-white" style="display: none;">
            <template v-if="basePropertysList.length>0" >
                <div v-for="item in basePropertysList" class="sku-item">
                    <span>{{item.pname}}</span>
                    <i class="color-6">{{item.pvalue}}&nbsp;&nbsp;&nbsp;</i>
                </div>
            </template>
            <template v-else>
                <div>
                    <div class="empty-icon"><img src="img/icons/no.png" alt=""></div>
                    <p class="fs-14 ta-c">暂时无此类商品参数~</p>
                </div>
            </template>
        </div>
        <!--买家评论-->
        <div class="switch evaluate bg-white" style="display: none;">
            <template v-if="evaluateVal && evaluateVal.length > 0">
                <ul>
                    <template v-for="list in evaluateVal">
                        <li>
                            <div class="top dis-table">
                                <div class="avatar dis-cell">
                                    <img :src="list.headImage || 'img\\icons\\defaultimg.png'" />
                                </div> 
                                <div class="dis-cell">
                                    {{list.username}}<br>
                                    <template v-for="i in list.score">
                                        <i class="dis-cell stara"></i>
                                    </template>
                                    <template v-for="x in 5-list.score">
                                        <i class="dis-cell star"></i>
                                    </template>
                                </div>
                                <div class="date">
                                    <em class="ta-r color-grey">{{list.time}}</em>
                                </div>
                            </div>
                            <div class="text">
                                <div>{{list.content}}</div>
                                <div class="img" v-if="list.images && list.images.images && list.images.images.length>0">
                                    <template v-for="img in list.images.images">
                                        <img class="eva-img" :src="img.url" v-on:click="showEvaImg(list.images.images, $index)">
                                    </template>
                                </div>
                                <div class="color-main mar-3" v-if="list.replied && list.replied.content">答复：{{list.replied.content}}</div>
                                <div class="color-grey mar-5" v-if="list.goodName">规格：{{list.goodName}}</div>
                                <div class="color-grey" v-if="list.buyTime">购买时间：{{list.buyTime}}</div>
                            </div>
                        </li>
                    </template>
                </ul>
            </template>
            <template v-else>
                <div>
                    <div class="empty-icon"><img src="img/icons/no.png" alt=""></div>
                    <p class="fs-14 ta-c">暂时无买家评价~</p>
                </div>
            </template>
        </div>
    </div>
     <div class="part-no bg-tr-grey" v-if="giftFlat == 'giftFlat'" v-on:click="gotoIndex()">
		该商品是赠品，看看别的吧～	
	</div>

	<div class="part-no bg-tr-grey" v-if="selectSukgood.onSalesNo ==0 && giftFlat != 'giftFlat'" v-on:click="gotoIndex()">
		该商品卖光了，看看别的吧～	
	</div>
    <div class="part-no bg-tr-grey" id="presell-unstart" style="display: none;" v-if="(activityType == 4 || activityType == 5) && selectSukgood.onSalesNo !=0 && !isSale && giftFlat != 'giftFlat'" v-on:click="gotoIndex()">
		预售暂还未开始，看看别的吧～	
	</div>
    <div class="br4"></div>
     <div  class="up-down1" >
        <div v-on:click="jumpToMess()" class="dis-cell w20">
            <i class="csad_orange"></i><br/><i>客服</i>
        </div>
        <div v-on:click="gotoIndex()" class="dis-cell w20">
            <i class="service-home1"></i><br/><i>商城首页</i>
        </div>
        <div id="share" class="dis-cell btn-active"><i class="share1 "></i>分享到微信</div>
     </div>
    
    <div style="display: none;" id="skuCon" class="full-bg">
        <div class="params-list clearfix">
            <div class="fr close-icon">
                <i v-on:click="screen(0)" class="iconfont">&#xe6cc;</i>
            </div>
            <ul >
                <li class="param-tit">
                    <div v-if="selectSukgood.coverImg" class="dis-cell param-img"><img :src="selectSukgood.coverImg.url || 'img/icons/gongg.png'" alt=""></div>
                    <div class="dis-cell param-right">
                        <h4>{{detail.name}}</h4>
                        <div class="param-pri">
                            <template v-if="activityType == 1">
                                <div class="color-main">零售价：¥{{selectSukgood.retailPrice}}</div>
                            </template>
                            <template v-if="activityType == 2">
                                <div class="color-main">促销价：¥{{detail.salePrice}}</div>
                            </template>
                            <template v-if="activityType == 3">
                                <div class="color-main">团购价：¥{{detail.salePrice}}</div>
                            </template>
                            <template v-if="activityType == 4">
                                <div class="color-main">定金：¥{{bestActivity.firstAmount}}</div>
                            </template>
                            <template v-if="activityType == 5">
                                <div class="color-main">预售价：¥{{bestActivity.presellAmount}}</div>
                            </template>
                            <div>
                                <span v-if="isSubAccount == 'F'">供货价：¥{{selectSukgood.supplyPrice}}</span>
                                <span class="fr fs-10">库存：{{selectSukgood.onSalesNo}}</span>
                            </div>
                        </div>
                    </div>
                </li>
                <!--第一层级-->
                <template v-if="oneFloor"> 
                    <template v-if="oneFloor.name">
                        <li>
                            <p>{{oneFloor.name}}</p>
                            <div class="clearfix">
                                <template v-for="one in oneFloor.cargoSkuItemList">
                                    <template v-if="one.isValid == 'T'">
                                        <template v-if="selectSukgood.skuValue && (selectSukgood.skuValue.indexOf(one.id) > -1)">
                                            <input class="norms" type="radio" checked="checked" name="{{oneFloor.name}}" id="{{oneFloor.name}}{{one.name}}" value="{{one.name}}" v-on:click="checkOne(one)">
                                            <label for="{{oneFloor.name}}{{one.name}}" class="fl">{{one.name}}</label>
                                        </template>
                                        <template v-else>
                                            <input class="norms" type="radio" name="{{oneFloor.name}}" id="{{oneFloor.name}}{{one.name}}" value="{{one.name}}" v-on:click="checkOne(one)">
                                            <label for="{{oneFloor.name}}{{one.name}}" class="fl">{{one.name}}</label>
                                        </template>
                                    </template>
                                    <template v-else>
                                            <input class="norms" type="checkbox" disabled name="{{oneFloor.name}}" id="{{oneFloor.name}}{{one.name}}" value="{{one.name}}" >
                                            <label for="{{oneFloor.name}}{{one.name}}" class="fl">{{one.name}}</label>
                                    </template>
                                </template>
                            </div>
                        </li>
                    </template>
                </template>
                <!--第二层级-->
                <template v-if="twoFloor"> 
                    <template v-if="twoFloor.name">
                        <li>
                            <p>{{twoFloor.name}}</p>
                            <div class="clearfix">
                                <template v-for="two in twoFloor.cargoSkuItemList">
                                    <template v-if="two.isValid == 'T'">
                                        <template v-if="selectSukgood.skuValue && (selectSukgood.skuValue.indexOf(two.id) > -1)">
                                            <input class="norms" type="radio" checked="checked" name="{{twoFloor.name}}" id="{{twoFloor.name}}{{two.name}}" value="{{two.name}}" v-on:click="checkTwo(two)">
                                            <label for="{{twoFloor.name}}{{two.name}}" class="fl">{{two.name}}</label>
                                        </template>
                                        <template v-else>
                                            <input class="norms" type="radio" name="{{twoFloor.name}}" id="{{twoFloor.name}}{{two.name}}" value="{{two.name}}" v-on:click="checkTwo(two)">
                                            <label for="{{twoFloor.name}}{{two.name}}" class="fl">{{two.name}}</label>
                                        </template>
                                    </template>
                                    <template v-else>
                                            <input class="norms" type="checkbox" disabled name="{{twoFloor.name}}" id="{{twoFloor.name}}{{two.name}}" value="{{two.name}}">
                                            <label for="{{twoFloor.name}}{{two.name}}" class="fl">{{two.name}}</label>
                                    </template>
                                </template>
                            </div>
                        </li>
                    </template>
                </template>
                <!--第三层级-->
                <template v-if="threeFloor"> 
                    <template v-if="threeFloor.name">
                        <li>
                            <p>{{threeFloor.name}}</p>
                            <div class="clearfix">
                                <template v-for="three in threeFloor.cargoSkuItemList">
                                    <template v-if="three.isValid == 'T'">
                                        <template v-if="selectSukgood.skuValue && (selectSukgood.skuValue.indexOf(three.id) > -1)">
                                            <input class="norms" type="radio" checked="checked" name="{{threeFloor.name}}" id="{{threeFloor.name}}{{three.name}}" value="{{three.name}}" v-on:click="checkThree(three)">
                                            <label for="{{threeFloor.name}}{{three.name}}" class="fl">{{three.name}}</label>
                                        </template>
                                        <template v-else>
                                            <input class="norms" type="radio" name="{{threeFloor.name}}" id="{{threeFloor.name}}{{three.name}}" value="{{three.name}}" v-on:click="checkThree(three)">
                                            <label for="{{threeFloor.name}}{{three.name}}" class="fl">{{three.name}}</label>
                                        </template>
                                    </template>
                                    <template v-else> 
                                            <input class="norms" type="checkbox" disabled name="{{threeFloor.name}}" id="{{threeFloor.name}}{{three.name}}" value="{{three.name}}" v-on:click="checkThree(three)">
                                            <label for="{{threeFloor.name}}{{three.name}}" class="fl">{{three.name}}</label>
                                    </template>
                                </template>
                            </div>
                        </li>
                    </template>
                </template>
                <li class="params-bottom">

                </li>
            </ul>
        </div>
    </div>
    <div id="sales" class="full-bg" style="display: none;">
        <div class="params-list clearfix">
            <div class="title">促销说明</div>
            <div class="text">从即日起，凡在我店购买SKOGSTAD斯高斯达短袖SUPPLEX短袖服装，不仅可享受惊爆特价￥158元，</div>
            <div v-on:click="screen(1)"class="clearfix buy-btn">
                <span class="fl w100 btn-active">知道了</span>
            </div>
        </div>
    </div>
    <div id="presellDeal" class="full-bg" style="display: none;">
        <div class="params-list clearfix">
            <div class="title">预售协议</div>
            <div class="text" v-if="bestActivity.presellAgreement" v-html="bestActivity.presellAgreement"></div>
            <div v-on:click="screen(2)"class="clearfix buy-btn">
                <span class="fl w100 btn-active">知道了</span>
            </div>
        </div>
    </div>
    <div style="display: none" class="cart1"></div>
    <!--<div class="part-no bg-tr-grey"  style="display: none" v-on:click="gotoIndex()">
            该商品暂时无货，可以选择上架显示～	
    </div>-->

    <div id="slider-box" style="z-index: 100; width: 100%; height: 100%; display: none; background-color: black; position: fixed; top: 0;">
        <div style="position: absolute; color: #fff; z-index: 999; top: 20px; right: 20px;" onclick="closeSilder()">关闭</div>
        <div id="iSlider-wrapper" style="width: 100%; height: 100%;"><div>
    </div>
</div>
</body>
<script src="js/jquery-1.8.2.min.js"></script>
<script src="//cdn.bootcss.com/Swiper/3.3.1/js/swiper.jquery.min.js"></script>
<script src="js/jquery.tmpl.min.js"></script>
<script src="js/vue.js"></script>
<script src="js/main.js"></script>
<script src="js/bizhelp.js"></script>
<script type="text/x-jquery-tmpl" id="index_advertise_t">
    <ul class="swiper-wrapper">
    {{each(i,advertise) datas}}
       <li class="swiper-slide">
        <a href="javascript:showBigImg('${goodId}', ${i});" target="_top" type="${advertise.lineStatus}" typeId="${advertise.id}"><img src="${advertise.url}"></a>
       </li>
     {{/each}}
    </ul>
    <div class="swiper-pagination"></div>
</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="js/iSlider.min.js"></script>
<script src="js/iSlider.animate.min.js"></script>


<script>
    Util.common.addloadingAnimate();
    var bigImgs = null;
    $(function () {
    goods.loadlist();
    goods.loadstate();
//    setInterval(timeCounter, 1000);
    var tuwenshow = $('#tuwen').offset().top;
    setTimeout(function(){
        tuwenshow = $('#tuwen').offset().top;
    }, 1000);
    $(window).scroll(function() {
        if ($(window).scrollTop() > tuwenshow) {
            $("#tuwen").addClass('fiexdTop');
        } else {
            $("#tuwen").removeClass('fiexdTop');
        }

        if ($(window).scrollTop() > 0) {
            $(".cart1").fadeIn(800);
        } else {
            $(".cart1").fadeOut(800);
        }

    });

    $(".cart1").click(function() {
        $('html,body').animate({
            scrollTop: 0
        },500);
    });
})

    var shopId = Util.common.getParameter("storeId") || localStorage.getItem("shopId");
    var id = Util.common.getParameter("id");
    var goods=new Vue({
        el:'#goodsDetail',
        data:{
            detail:{},
            detailInfo:'',
            state:0,
            evaluateVal: [],
            evaluateThree: [],
            //sku商品数组
            tradeGoodSkuVoList: [],
            //产品参数
            basePropertysList: [],
            //选中sku商品
            selectSukgood: {},
            // 商品活动类型 1:普通商品; 2：促销商品; 3:团购商品; 4:预售商品(定金) 5:预售商品（全款）
            activityType: 1,
            //商品活动类型
            bestActivity: {},
            //规格层级处理
            oneFloor: {},
            twoFloor: {},
            threeFloor: {},
            //是否在售状态
            isSale: false,
            //商品图文中图片详情
            imgList: [],
//          是否子帐号
            isSubAccount: localStorage.getItem('isSubAccount') || Util.common.getParameter("isSubAccount") || 'T',
        },
        computed:{

        },
        methods:{

            gotoIndex:function() {
                window.location.href="index.html?shopId="+shopId;
            },
            loadstate:function () {
                goods.$set("state",localStorage.getItem("sortType"));

            },
            loadlist:function () {
                //    获取商品详情
                var url ="weixin/good/getGoodDetail";
                var param = {"goodId": Util.common.getParameter("id"), "userId": shopId};
                localStorage.setItem('goodId', Util.common.getParameter("id"));
                Util.common.b2cPostCallback(url, param, function (data) {
                    console.log(data);
                    var dataInfo = {};
                    if (data.success && data.data && data.data.tradeGoodSkuVoList) {
                        dataInfo = data.data;
                    } else {
                        window.setTimeout(function(){
                            history.back();
                        },2000)
                        new Toast({context:$('body'),message:"商品数据异常"}).show();
                        return;
                    }

                    //库存取货品库存和sku库存的最小值
                    for (var i=0;i<dataInfo.tradeGoodSkuVoList.length;i++) {
                        if (dataInfo.tradeGoodSkuVoList[i].cargoSkuStock < dataInfo.tradeGoodSkuVoList[i].onSalesNo) {
                            dataInfo.tradeGoodSkuVoList[i].onSalesNo = dataInfo.tradeGoodSkuVoList[i].cargoSkuStock;
                            if (dataInfo.tradeGoodSkuVoList[i].onSalesNo< 0) {
                                dataInfo.tradeGoodSkuVoList[i].onSalesNo = 0;
                            }
                        }
                    }
                    
                    //素材库请求
                    if (window.WebAppJS) {
                        WebAppJS.showTopTitleView(dataInfo.id);
                    }
                    
                    //分享
                    $("#share").on("click", function(){
                        if(window.WebAppJS){
                            WebAppJS.share(dataInfo.name, "这款被大家热捧的宝贝，据说快要卖光啦~你还不看看？", dataInfo.showImages.images[0].url, Util.common.baseUrl +  "weixin/weixinClient/index.do?fromshanguo=weixinfront/static/goods_detail.html?share=0&storeId="+shopId+"&id="+id+"&type=weixinIndex");
                        }
                    });

//                  渲染默认sku商品为sku商品数组的第一个
                    goods.$set("tradeGoodSkuVoList",dataInfo.tradeGoodSkuVoList);
                    goods.$set("selectSukgood",dataInfo.tradeGoodSkuVoList[0]);

                    //查看商品活动类型
                    goods.activity(dataInfo.tradeGoodSkuVoList[0]);
                    //处理商品规格
                    goods.$set("oneFloor", dataInfo.cargoSkuType);
                    if (dataInfo.cargoSkuType.cargoSkuItemList && dataInfo.cargoSkuType.cargoSkuItemList.length > 0) {
                        for (var i=0;i<dataInfo.cargoSkuType.cargoSkuItemList.length;i++) {
                            if (dataInfo.cargoSkuType.cargoSkuItemList[i].isValid == 'T' && dataInfo.cargoSkuType.cargoSkuItemList[i].skuType) {
                                goods.$set("twoFloor", dataInfo.cargoSkuType.cargoSkuItemList[i].skuType);
                                break;
                            }
                        }
                    } 
                    if (goods.twoFloor.cargoSkuItemList && goods.twoFloor.cargoSkuItemList.length > 0) {
                        for(var i=0;i<goods.twoFloor.cargoSkuItemList.length;i++) {
                            if (goods.twoFloor.cargoSkuItemList[i].isValid == 'T' && goods.twoFloor.cargoSkuItemList[i].skuType) {
                                goods.$set("threeFloor", goods.twoFloor.cargoSkuItemList[i].skuType);
                                break;
                            }
                        }
                    }
                    //产品参数
                    if (dataInfo.basePropertysList) {
                        goods.$set("basePropertysList", dataInfo.basePropertysList);
                    }
                    //图文的图片数组
                    if (dataInfo.detailImages && dataInfo.detailImages.images && dataInfo.detailImages.images.length>0) {
                        goods.$set("imgList", dataInfo.detailImages.images);
                    }
//                    买家评论
                    if(dataInfo.goodEvaluationList!=undefined){
                        var evaluateList = dataInfo.goodEvaluationList;
                        for(var i in evaluateList) {
                            if (evaluateList[i].evaluateTime) {
                                var arr = evaluateList[i].evaluateTime.split(' ');
                                evaluateList[i].time =  arr[0];
                            }
                            if (!evaluateList[i].content) {
                                evaluateList[i].content = '该用户没有留下评论内容!'
                            }
                            if (evaluateList[i].buyTime) {
                                evaluateList[i].buyTime = tofromTime(new Date(evaluateList[i].buyTime));
                                var arr = evaluateList[i].buyTime.split(' ');
                                evaluateList[i].buyTime =  arr[0];
                            }
                        }
                        var evaluateT = evaluateList.slice(0,3);
                        goods.$set("evaluateThree",evaluateT);
                        goods.$set("evaluateVal",evaluateList);
                    }
//                    获取商品轮播图渲染到tmpl模板 
                    var datas = {};
                    if (dataInfo.showImages && dataInfo.showImages.images) {
                        datas ={"datas":dataInfo.showImages.images, goodId: Util.common.getParameter("id")};
                        bigImgs = dataInfo.showImages.images.map(function(item){
                            return {content: item.url};
                        });
                    }   

                    Util.common.loadTemplate("#slider-content", "#index_advertise_t", datas);
                    Util.common.initAdvertiseSlide(datas);
                    goods.$set("detailInfo",dataInfo.detailInfo);

                    goods.$set("detail",dataInfo);
                    var goodInfoObj={
                        name:dataInfo.name,
                        imgUrl:dataInfo.smallImage,
                        salePrice:dataInfo.salePrice,
                        cargoNo:dataInfo.cargoNo,
                        id:Util.common.getParameter("id")
                    }

                    Util.common.removeloadingAnimate('detailCon');
                });

            },
//            规格弹窗
            screen:function (type) {
                if (type==0){
//                    点击选择规格
                    $("#btnType3").css("display","none");
                    $("#btnType2").css("display","none");
                    $("#btnType1").css("display","none");
                    $("#btnType0").css("display","block");
                    $("#skuCon").fadeToggle(10);
                    if($("body").hasClass('hide')){
                        $("body").removeClass("hide");
                    }else{
                        $("body").addClass("hide");
                    }
                }else if(type==1){
//                    促销
                    $("#btnType3").css("display","none");
                    $("#btnType2").css("display","none");
                    $("#btnType0").css("display","none");
                    $("#btnType1").css("display","block");
                    $("#sales").fadeToggle(10);
                    if($("body").hasClass('hide')){
                        $("body").removeClass("hide");
                    }else{
                        $("body").addClass("hide");
                    }
                } else if(type==2) {
//                    预售
                    $("#presellDeal").fadeToggle(10);
                    if($("body").hasClass('hide')){
                        $("body").removeClass("hide");
                    }else{
                        $("body").addClass("hide");
                    }
                }

            },
            jumpto:function () {
                window.location.href='evaluation.html?goodId='+Util.common.getParameter("id")+"&shopId="+shopId;
            },
            jumpToMess: function() {
                var info = {};
                info.title = goods.detail.name + '(商城)';
                info.desc = '';
                info.pictureUrlString = goods.detail.showImages.images[0].url;
                info.note = '商品ID:' + goods.detail.id;
                info.show = true;
                info = JSON.stringify(info)
                console.log(info);
                if(window.WebAppJS){
                    WebAppJS.gotoMessWithInfo(info);
                } 
            },
            switchT:function (id) {
//               切换商品详情，买家评论
                $(".switchTit").removeClass("color-main");
                $("#"+id).addClass("color-main");
                $("#"+id+"1").addClass("color-main");
                $(".switch").hide();
                $("."+id).show();
            },
            toShow: function(id) {
                document.getElementById("tuwen").scrollIntoView();
                goods.switchT(id)
            },
            //规格层级筛选
            checkOne: function(one) {
                if (one.skuId) {
                    goods.selectSkuGood(one.skuId);
                    return;
                }
                if (one.skuType) {
                    goods.$set('twoFloor', one.skuType);
                    if (goods.twoFloor.cargoSkuItemList && goods.twoFloor.cargoSkuItemList.length>0) {
                        for(var i=0; i<goods.twoFloor.cargoSkuItemList.length;i++) {
                            if (goods.twoFloor.cargoSkuItemList[i].skuId) {
                                goods.selectSkuGood(goods.twoFloor.cargoSkuItemList[i].skuId);
                                return;
                            }
                        }
                        for(var i=0;i<goods.twoFloor.cargoSkuItemList.length;i++) {
                            if (goods.twoFloor.cargoSkuItemList[i].isValid == 'T') {
                                goods.checkTwo(goods.twoFloor.cargoSkuItemList[i]);
                                break;
                            }
                        }
                    }
                }
            },
            checkTwo: function(two) {
                console.log(two)
                if (two.skuId) {
                    goods.selectSkuGood(two.skuId);
                    return;
                }
                if (two.skuType) {
                    goods.$set('threeFloor', two.skuType);
                    if (goods.threeFloor.cargoSkuItemList && goods.threeFloor.cargoSkuItemList.length>0) {
                        for(var i=0;i<goods.threeFloor.cargoSkuItemList.length;i++) {
                            if (goods.threeFloor.cargoSkuItemList[i].skuId) {
                                goods.selectSkuGood(goods.threeFloor.cargoSkuItemList[i].skuId);
                                return;
                            }
                        }
                    }
                }
            }, 
            checkThree: function(three) {
                console.log(three)
                if (three.skuId) {
                    goods.selectSkuGood(three.skuId);
                }
            }, 
            // 遍历选中skuId商品
            selectSkuGood: function(skuId) {
                for(var i in goods.tradeGoodSkuVoList) {
                    if (skuId === goods.tradeGoodSkuVoList[i].id) {
                        goods.$set("selectSukgood", goods.tradeGoodSkuVoList[i]);
                        goods.activity(goods.selectSukgood);
                        console.log(goods.selectSukgood)
                    }
                }
            },
            //查看选中商品的活动类型
            activity: function(selectSukgood) {
                var bestActivity = {};
                if (selectSukgood.promotionalInfo && selectSukgood.promotionalInfo.bestActivity) {
                    bestActivity = selectSukgood.promotionalInfo.bestActivity;
                    //预售
                    if (bestActivity.activityType == 'presell') {
                        //定金
                        if (bestActivity.presellType == 'second') {
                            goods.$set("activityType", 4);
                            $('.countTitle').html('定金');
                            $('.countPrice').html('¥'+bestActivity.firstAmount);
                            bestActivity.paymentStartShow = formatDate(new Date(bestActivity.paymentStart)); 
                            bestActivity.paymentEndShow = formatDate(new Date(bestActivity.paymentEnd)); 
                        }
                        //全款
                        if (bestActivity.presellType == 'one') {
                            goods.$set("activityType", 5);
                            $('.countTitle').html('预售价');
                            $('.countPrice').html('¥'+bestActivity.presellAmount);
                        }
                        //倒计时
                        if (bestActivity.activityStart && bestActivity.activityEnd) {
                            setInterval(function () {
                                timeCounter(bestActivity.activityStart,bestActivity.activityEnd);
                            },1000);
                        }
                        //预计发货时间
                        if (bestActivity.shipTime) {
                            bestActivity.shipTimeShow = formatDate2(new Date(bestActivity.shipTime)); 
                        }
                        //修改预售库存 
                        goods.selectSukgood.onSalesNo = bestActivity.presellNum;
                    }
                    goods.$set("bestActivity", bestActivity);
                }
            },
            showEvaImg:function(imgList, index) {
                bigImgs = imgList.map(function(item) {
                    return {content: item.url};
                });
                showSlide(bigImgs, index);
            }  
        }
    });

//同步app 端倒计时 
var timeCounter = function(_start,_end){
    // console.log("111");
    var $timer  = $("#timer-out");
    var curTimer=new Date().getTime();
    var startTimer= _start;
    var endTimer= _end;
    var t=0;
    if(startTimer>curTimer ){
        if (goods.activityType == 4) {
            $timer.find('.title-show').html("距支付定金开始:");
        } 
        $('#presell-unstart').css('display', '');
        // if (!$('.swiper-pagination').hasClass('swiper-pagination-height')) {
        //     $('.swiper-pagination').addClass('swiper-pagination-height');
        // }
        t=startTimer-curTimer;
        var d=Math.floor(t/1000/60/60/24);
        var h=Math.floor(t/1000/60/60%24);
        var m=Math.floor(t/1000/60%60);
        var s=Math.floor(t/1000%60);
        if(d<10&&d>=0){
            $timer.find('.day').html('0'+d);
        }else {
            $timer.find('.day').html(d);
        }
        if(h<10&&h >=0){
            $timer.find('.hour').html('0'+h);
        }else{
            $timer.find('.hour').html(h);
        }
        if(m<10&&m >=0){
            $timer.find('.min').html('0'+m);
        }else{
            $timer.find('.min').html(m);
        }
        if(s<10 && s>=0){
            $timer.find('.sec').html('0'+s);
        }else{
            $timer.find('.sec').html(s);
        }
        $timer.show();
        
    }else if(startTimer<curTimer && curTimer<endTimer){
        if (goods.activityType == 4) {
            $timer.find('.title-show').html("距支付定金结束:");
        } else {
            $timer.find('.title-show').html("距结束仅剩:");
        }
        
        t=endTimer-curTimer;
        // if (!$('.swiper-pagination').hasClass('swiper-pagination-height')) {
        //     $('.swiper-pagination').addClass('swiper-pagination-height');
        // }
        // isSale正在预售中
        goods.$set('isSale', true);
        $('.countTitle').css('background','rgb(223, 42, 82)');
        $('.countPrice-view').css('background','rgb(223, 42, 82)');
        $('.count-right').css('background','rgb(225, 83, 100)');
        $('.hour').css('background','rgb(194, 29, 65)');
        $('.min').css('background','rgb(194, 29, 65)');
        $('.sec').css('background','rgb(194, 29, 65)');
        var d=Math.floor(t/1000/60/60/24);
        var h=Math.floor(t/1000/60/60%24);
        var m=Math.floor(t/1000/60%60);
        var s=Math.floor(t/1000%60);
        if(d<10&&d>=0){
            $timer.find('.day').html('0'+d);
        }else {
            $timer.find('.day').html(d);
        }
        if(h<10&&h >=0){
            $timer.find('.hour').html('0'+h);
        }else{
            $timer.find('.hour').html(h);
        }
        if(m<10&&m >=0){
            $timer.find('.min').html('0'+m);
        }else{
            $timer.find('.min').html(m);
        }
        if(s<10 && s>=0){
            $timer.find('.sec').html('0'+s);
        }else{
            $timer.find('.sec').html(s);
        }
        $timer.show();
    }
}
function formatDate(now) { 
    var month=now.getMonth()+1; 
    var date=now.getDate(); 
    var hour=now.getHours(); 
    var minute=now.getMinutes(); 
    var second=now.getSeconds(); 
    return month+"月"+date+"日"+dateDouble(hour)+":"+dateDouble(minute); 
} 
function formatDate2(now) {
    var year=now.getFullYear(); 
    var month=now.getMonth()+1; 
    var date=now.getDate(); 
    return year+"年"+month+"月"+date+"日";  
}
function dateDouble(num) {
    if(num<10&&num >=0){
        num = '0' + num;
    }
    return num
}
function showBigImg(goodId, index){
    // $(window).scrollTop(0);
    if (!bigImgs){
        Util.common.executeAjaxCallback("/weixin/good/listDetailImage.do", {goodId: goodId}, function (result) {
            if (result.success && result.data && result.data.imageList){

                bigImgs = result.data.imageList.map(function(item){
                    return {content: item.picUrl};
                });

                showSlide(bigImgs, index);
            }
        });
        
    }
    else {
        bigImgs = goods.detail.showImages.images.map(function(item){
            return {content: item.url};
        });
        showSlide(bigImgs, index);
    }
}

function showSlide(datas, index){
    $('#iSlider-wrapper').empty();
    $("#slider-box").show();

    // 数据重新排序
    var newdatas = [];
    for (var i = index; i < datas.length; i++){
        newdatas.push(datas[i]);
    }
    for (var i = 0; i < index; i++){
        newdatas.push(datas[i]);
    }

    console.log(newdatas);

    var slider = new iSlider(document.getElementById('iSlider-wrapper'), newdatas, {
        isAutoplay: 0,
        isLooping: 1,
        isOverspread: 1,
        animateTime: 800
    });
}

function closeSilder(){
    $("#slider-box").hide();
}
        
        


</script>
</html>